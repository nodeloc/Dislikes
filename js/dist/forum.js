(()=>{var t={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return t.d(n,{a:n}),n},d:(o,n)=>{for(var e in n)t.o(n,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:n[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{extend:()=>X});const n=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/app"];var s=t.n(e);const i=flarum.core.compat["forum/components/NotificationGrid"];var r=t.n(i);function a(t,o){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},a(t,o)}function l(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,a(t,o)}const c=flarum.core.compat["common/components/Button"];var u=t.n(c);const d=flarum.core.compat["forum/components/CommentPost"];var f=t.n(d);const p=flarum.core.compat["common/components/Modal"];var k=t.n(p),y=function(t){function o(){return t.apply(this,arguments)||this}l(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.isDisliked=this.attrs.isDisliked},n.className=function(){return"DislikeConfirmationModal Modal--small"},n.title=function(){return s().translator.trans(this.isDisliked?"nodeloc-dislikes.forum.undislike_confirmation_title":"nodeloc-dislikes.forum.dislike_confirmation_title")},n.content=function(){return m("div",{className:"Modal-body"},m("p",null,s().translator.trans(this.isDisliked?"nodeloc-dislikes.forum.undislike_confirmation_text":"nodeloc-dislikes.forum.dislike_confirmation_text")),m("div",{className:"Form-group"},u().component({className:"Button Button--primary Button--block",onclick:this.attrs.onconfirm},s().translator.trans(this.isDisliked?"nodeloc-dislikes.forum.confirm_undislike":"nodeloc-dislikes.forum.confirm_dislike"))))},o}(k());const h=flarum.core.compat["common/components/Link"];var v=t.n(h);const b=flarum.core.compat["common/helpers/punctuateSeries"];var _=t.n(b);const g=flarum.core.compat["common/helpers/username"];var P=t.n(g);const x=flarum.core.compat["common/helpers/icon"];var N=t.n(x);const D=flarum.core.compat["common/helpers/avatar"];var j=t.n(D);function w(){return w=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var e in n)({}).hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},w.apply(null,arguments)}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function S(t){var o=function(t,o){if("object"!=O(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var e=n.call(t,"string");if("object"!=O(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(o)?o:o+""}function B(t,o){for(var n=0;n<o.length;n++){var e=o[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,S(e.key),e)}}const M=flarum.core.compat["common/states/PaginatedListState"];var C=function(t){function o(o,n){return void 0===n&&(n=1),o.page=w({},o.page||{},{limit:10}),t.call(this,o,n,10)||this}return l(o,t),n=o,(e=[{key:"type",get:function(){return"users"}}])&&B(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e}(t.n(M)());const L=flarum.core.compat["common/components/LoadingIndicator"];var I=t.n(L),F=function(t){function o(){return t.apply(this,arguments)||this}l(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.state=new C({filter:{disliked:this.attrs.post.id()}}),this.state.refresh()},n.className=function(){return"PostDislikesModal Modal--small"},n.title=function(){return s().translator.trans("nodeloc-dislikes.forum.post_dislikes.title")},n.content=function(){var t=this;return m("[",null,m("div",{className:"Modal-body"},this.state.isInitialLoading()?m(I(),null):m("ul",{className:"PostDislikesModal-list"},this.state.getPages().map((function(t){return t.items.map((function(t){return m("li",null,m(v(),{href:s().route.user(t)},j()(t)," ",P()(t)))}))})))),this.state.hasNext()?m("div",{className:"Modal-footer"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m(u(),{className:"Button Button--block",onclick:function(){return t.state.loadNext()},loading:this.state.isLoadingNext()},s().translator.trans("nodeloc-dislikes.forum.post_dislikes.load_more_button"))))):null)},o}(k());const T=flarum.core.compat["forum/components/Notification"];var U=t.n(T);const R=flarum.core.compat["common/utils/string"];var z=function(t){function o(){return t.apply(this,arguments)||this}l(o,t);var n=o.prototype;return n.icon=function(){return"far fa-thumbs-down"},n.href=function(){return s().route.post(this.attrs.notification.subject())},n.content=function(){var t=this.attrs.notification.fromUser();return s().translator.trans("nodeloc-dislikes.forum.notifications.post_disliked_text",{user:t,count:1})},n.excerpt=function(){return(0,R.truncate)(this.attrs.notification.subject().contentPlain(),200)},o}(U());const A=flarum.core.compat["forum/components/UserPage"];var E=t.n(A);const G=flarum.core.compat["common/components/LinkButton"];var H=t.n(G);const q=flarum.core.compat["common/extenders"];var J=t.n(q);const K=flarum.core.compat["common/models/Post"];var Q=t.n(K);const V=flarum.core.compat["forum/components/PostsUserPage"];var W=function(t){function o(){return t.apply(this,arguments)||this}return l(o,t),o.prototype.loadResults=function(t){return s().store.find("posts",{filter:{type:"comment",dislikedBy:this.user.id()},page:{offset:t,limit:this.loadLimit},sort:"-createdAt"})},o}(t.n(V)());const X=[(new(J().Routes)).add("user.dislikes","/u/:username/dislikes",W),new(J().Model)(Q()).hasMany("dislikes").attribute("dislikesCount").attribute("canDislike")];s().initializers.add("nodeloc-dislikes",(function(){s().notificationComponents.postDisliked=z,(0,n.extend)(f().prototype,"actionItems",(function(t){var o=this.attrs.post;if(!o.isHidden()&&o.canDislike()){var n=o.dislikes(),e=s().session.user&&n&&n.some((function(t){return t===s().session.user}));t.add("dislike",m(u(),{className:"Button Button--link",onclick:function(){s().modal.show(y,{isDisliked:e,energyCost:5,onconfirm:function(){e=!e,o.save({isDisliked:e});var t=o.data.relationships.dislikes.data;if(e)t.unshift({type:"users",id:s().session.user.id()});else{var n=t.findIndex((function(t){return t.id===s().session.user.id()}));-1!==n&&t.splice(n,1)}s().modal.close()}})}},s().translator.trans(e?"nodeloc-dislikes.forum.post.undislike_link":"nodeloc-dislikes.forum.post.dislike_link")))}})),(0,n.extend)(f().prototype,"footerItems",(function(t){var o=this.attrs.post,n=o.dislikes();if(n&&n.length){var e=o.dislikesCount()>4,i=n.sort((function(t){return t===s().session.user?-1:1})).slice(0,e?3:4).map((function(t){return m(v(),{href:s().route.user(t)},t===s().session.user?s().translator.trans("nodeloc-dislikes.forum.post.you_text"):P()(t))}));if(e){var r=o.dislikesCount()-i.length,a=s().translator.trans("nodeloc-dislikes.forum.post.others_link",{count:r});s().forum.attribute("canSearchUsers")?i.push(m(u(),{className:"Button Button--ua-reset Button--text",onclick:function(t){t.preventDefault(),s().modal.show(F,{post:o})}},a)):i.push(m("span",null,a))}t.add("disliked",m("div",{className:"Post-dislikedBy"},N()("far fa-thumbs-down"),s().translator.trans("nodeloc-dislikes.forum.post.disliked_by"+(n[0]===s().session.user?"_self":"")+"_text",{count:i.length,users:_()(i)})))}})),(0,n.extend)(E().prototype,"navItems",(function(t){var o=this.user;t.add("dislikes",m(H(),{href:s().route("user.dislikes",{username:null==o?void 0:o.slug()}),icon:"far fa-thumbs-down"},s().translator.trans("nodeloc-dislikes.forum.user.dislikes_link")),88)})),(0,n.extend)(r().prototype,"notificationTypes",(function(t){t.add("postDisliked",{name:"postDisliked",icon:"far fa-thumbs-down",label:s().translator.trans("nodeloc-dislikes.forum.settings.notify_post_disliked_label")})}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map